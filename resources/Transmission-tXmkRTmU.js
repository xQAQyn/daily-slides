import{_ as f,s as y,r as _,c as g,o as n,w as d,b as i,d as w,e as o,t as r,F as u,a}from"./index-BF4DSS10.js";const h=["B","KB","MB","GB"],m=s=>{let t=0;for(;s>1e3&&t<h.length-1;)s/=1e3,t++;return Intl.NumberFormat(void 0,{maximumFractionDigits:2}).format(s||0)+` ${h[t]}/s`},R={name:"Transmission",mixins:[y],props:{item:Object},data:()=>({dl:null,ul:null,count:null,error:null,sessionId:null,retry:0}),computed:{downRate:function(){return m(this.dl)},upRate:function(){return m(this.ul)}},created(){const s=parseInt(this.item.interval,10)||0;s>0&&setInterval(()=>this.getStats(),s),this.getStats()},methods:{transmissionRequest:async function(s){const t=this.getRequestHeaders(s);this.sessionId&&(t.headers["X-Transmission-Session-Id"]=this.sessionId);try{return await this.fetch("transmission/rpc",t)}catch(e){if(e.cause.status==409&&this.retry<=1){const c=await this.getSession();if(c)return this.sessionId=c,this.retry++,this.transmissionRequest(s)}throw console.error("Transmission RPC error:",e),e}},getRequestHeaders:function(s){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({method:s})};return this.item.auth&&(t.headers.Authorization=`Basic ${btoa(this.item.auth)}`),t},getSession:async function(){try{await this.fetch("transmission/rpc",this.getRequestHeaders("session-get"))}catch(s){if(s.cause.status==409)return s.cause.headers.get("X-Transmission-Session-Id")}},getStats:async function(){try{const s=await this.transmissionRequest("session-stats");if(s?.result!=="success")throw new Error(`Transmission RPC failed: ${s?.result||"Unknown error"}`);const t=s.arguments;this.dl=t.downloadSpeed??0,this.ul=t.uploadSpeed??0,this.count=t.activeTorrentCount??0,this.error=!1}catch(s){this.error=!0,console.error("Transmission service error:",s)}}}},I={class:"title is-4"},S={key:0,class:"subtitle is-6"},b={key:1,class:"subtitle is-6"},k={key:0,class:"error"},T={class:"down monospace"},B={class:"up monospace"},v={key:0,class:"count"};function C(s,t,e,c,q,l){const p=_("Generic");return n(),g(p,{item:e.item},{content:d(()=>[a("p",I,r(e.item.name),1),e.item.subtitle?(n(),i("p",S,r(e.item.subtitle),1)):(n(),i("p",b,[s.error?(n(),i("span",k,"An error has occurred.")):(n(),i(u,{key:1},[a("span",T,[t[0]||(t[0]=a("p",{class:"fas fa-download"},null,-1)),o(" "+r(l.downRate),1)]),a("span",B,[t[1]||(t[1]=a("p",{class:"fas fa-upload"},null,-1)),o(" "+r(l.upRate),1)])],64))]))]),indicator:d(()=>[s.error?w("",!0):(n(),i("span",v,[o(r(s.count||0)+" ",1),(s.count||0)===1?(n(),i(u,{key:0},[o("torrent")],64)):(n(),i(u,{key:1},[o("torrents")],64))]))]),_:1},8,["item"])}const x=f(R,[["render",C],["__scopeId","data-v-7c3b06be"]]);export{x as default};
